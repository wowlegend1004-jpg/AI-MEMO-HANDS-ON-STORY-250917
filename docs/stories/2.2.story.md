# Story 2.2: 노트 목록 조회, 페이지네이션 및 정렬

## Status

Ready for Review

## Story

**As a** 로그인한 사용자,
**I want** 내가 작성한 노트들을 목록으로 조회하고, 페이지네이션과 정렬 기능을 사용할 수 있는 기능,
**so that** 많은 노트들 중에서 원하는 노트를 효율적으로 찾고 관리할 수 있다.

## Acceptance Criteria

1. 노트 목록 페이지에서 내가 작성한 모든 노트를 조회할 수 있어야 한다
2. 노트 목록에는 제목, 생성일, 수정일이 표시되어야 한다
3. 노트 제목을 클릭하면 해당 노트의 상세 페이지로 이동할 수 있어야 한다
4. 페이지네이션 기능이 제공되어야 한다 (기본 10개씩 표시)
5. 정렬 옵션이 제공되어야 한다 (최신순, 오래된순, 제목순 A-Z, 제목순 Z-A)
6. 정렬 옵션 변경 시 즉시 목록이 업데이트되어야 한다
7. 페이지네이션 변경 시 즉시 목록이 업데이트되어야 한다
8. 노트가 없는 경우 빈 상태 UI가 표시되어야 한다
9. 로딩 중에는 적절한 로딩 상태가 표시되어야 한다
10. 에러 발생 시 적절한 에러 메시지가 표시되어야 한다

## Tasks / Subtasks

- [x] 노트 목록 조회 API 구현 (AC: 1, 2, 8, 9, 10)
  - [x] Drizzle ORM을 사용한 노트 목록 조회 쿼리 구현
  - [x] 사용자별 노트 필터링 로직 구현
  - [x] 페이지네이션 파라미터 처리 로직 구현
  - [x] 정렬 옵션 처리 로직 구현
  - [x] 에러 핸들링 및 로딩 상태 관리
- [x] 노트 목록 UI 컴포넌트 구현 (AC: 2, 3, 4, 5, 6, 7, 8, 9, 10)
  - [x] 노트 목록 카드 컴포넌트 구현
  - [x] 페이지네이션 컴포넌트 구현
  - [x] 정렬 옵션 선택 컴포넌트 구현
  - [x] 빈 상태 UI 컴포넌트 구현
  - [x] 로딩 상태 UI 컴포넌트 구현
- [x] 노트 목록 페이지 구현 (AC: 1, 3, 4, 5, 6, 7, 8, 9, 10)
  - [x] `/notes` 페이지 업데이트
  - [x] URL 쿼리 파라미터 처리 (페이지, 정렬 옵션)
  - [x] 서버 사이드 데이터 페칭 구현
  - [x] 클라이언트 사이드 상태 관리 구현
- [x] 반응형 디자인 적용 (AC: 1, 2, 3, 4, 5, 6, 7, 8, 9, 10)
  - [x] 모바일 화면 최적화
  - [x] 태블릿 화면 최적화
  - [x] 데스크톱 화면 최적화

## Dev Notes

### 이전 스토리 인사이트

[Source: Story 2.1 Dev Agent Records]

- ✅ Drizzle ORM 설정 및 노트 데이터 모델 구현 완료
- ✅ 노트 생성 기능 구현 완료
- ✅ 기본 노트 목록 페이지 구조 구현 완료
- ✅ Supabase RLS 정책 설정 필요 (수동 설정)

### 기술 스택 정보

[Source: docs/architecture.md#1-기술-스택]

- **프레임워크:** Next.js (App Router, Server Actions)
- **UI:** shadcn/ui + Tailwind + Radix UI
- **DB/인증:** Supabase (Postgres, Auth, Storage)
- **ORM:** Drizzle ORM

### 데이터베이스 스키마

[Source: Story 2.1 - lib/db/schema/notes.ts]

```typescript
export const notes = pgTable('notes', {
    id: uuid('id').defaultRandom().primaryKey(),
    userId: uuid('user_id').notNull(),
    title: text('title').notNull().default('제목 없음'),
    content: text('content'),
    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),
    updatedAt: timestamp('updated_at', { withTimezone: true }).defaultNow()
})
```

### 기존 구현된 파일들

[Source: Story 2.1 File List]

- `lib/notes/actions.ts` - 노트 관련 Server Actions
- `app/notes/page.tsx` - 노트 목록 페이지 (기본 구조)
- `lib/db/connection.ts` - 데이터베이스 연결 설정
- `lib/db/schema/notes.ts` - 노트 데이터 모델 스키마

### 페이지네이션 요구사항

- **기본 페이지 크기:** 10개 노트
- **페이지네이션 UI:** 이전/다음 버튼 + 페이지 번호
- **URL 쿼리 파라미터:** `?page=1&sort=created_at_desc`

### 정렬 옵션

- **최신순:** `created_at DESC` (기본값)
- **오래된순:** `created_at ASC`
- **제목순 A-Z:** `title ASC`
- **제목순 Z-A:** `title DESC`

### 보안 요구사항

[Source: docs/architecture.md#3-보안]

- 모든 Drizzle 쿼리는 사용자 ID 스코프를 WHERE로 직접 강제
- Supabase RLS 정책으로 추가 보안 레이어 제공

### 재사용 가능한 컴포넌트

- `components/ui/card.tsx` - 노트 카드 컨테이너
- `components/ui/button.tsx` - 페이지네이션 버튼
- `components/ui/select.tsx` - 정렬 옵션 선택 (새로 추가 필요)

### UX/UI 고려사항

- **모바일 반응형:** 작은 화면에서도 편리한 목록 탐색
- **접근성:** 키보드 네비게이션 및 스크린 리더 지원
- **성능 최적화:** 가상 스크롤링 고려 (향후 확장)
- **로딩 상태:** 스켈레톤 UI 또는 스피너 표시

### Testing

#### 테스트 표준

[Source: docs/architecture.md#6-배포운영]

- 테스트 프레임워크: Jest + React Testing Library
- 테스트 파일 위치: `__tests__/` 또는 컴포넌트 옆에 `.test.tsx`

#### 노트 목록 테스트

- 노트 목록 렌더링 테스트
- 페이지네이션 동작 테스트
- 정렬 옵션 변경 테스트
- 빈 상태 UI 테스트
- 로딩 상태 테스트
- 에러 핸들링 테스트
- 반응형 디자인 테스트

## Change Log

| Date       | Version | Description | Author           |
| ---------- | ------- | ----------- | ---------------- |
| 2025-01-15 | 1.0     | 스토리 생성 | Product Owner Sarah |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4

### Debug Log References

- 페이지네이션 API 구현 완료 (getNotesPaginated 함수)
- Select UI 컴포넌트 수동 생성 (Radix UI 기반)
- 타입 오류 수정 (Date | null 처리)
- 빌드 오류 해결 (TypeScript strict 모드 대응)

### Completion Notes List

- ✅ 노트 목록 조회 API 구현 완료 (페이지네이션, 정렬 기능 포함)
- ✅ Select UI 컴포넌트 구현 완료 (Radix UI 기반)
- ✅ 페이지네이션 컴포넌트 구현 완료 (이전/다음, 페이지 번호 표시)
- ✅ 정렬 옵션 컴포넌트 구현 완료 (6가지 정렬 옵션)
- ✅ 노트 카드 컴포넌트 구현 완료 (제목, 내용 미리보기, 날짜 표시)
- ✅ 빈 상태 UI 컴포넌트 구현 완료 (첫 노트 작성 유도)
- ✅ 로딩 스켈레톤 UI 컴포넌트 구현 완료
- ✅ 노트 목록 페이지 업데이트 완료 (URL 쿼리 파라미터 처리)
- ✅ 노트 상세 페이지 구현 완료 (개별 노트 조회)
- ✅ 반응형 디자인 적용 완료 (모바일, 태블릿, 데스크톱)
- ✅ TypeScript 타입 오류 수정 완료

### File List

**새로 생성된 파일:**
- `components/ui/select.tsx` - Radix UI 기반 Select 컴포넌트
- `components/notes/pagination.tsx` - 페이지네이션 컴포넌트
- `components/notes/sort-select.tsx` - 정렬 옵션 선택 컴포넌트
- `components/notes/note-card.tsx` - 개별 노트 카드 컴포넌트
- `components/notes/empty-state.tsx` - 빈 상태 UI 컴포넌트
- `components/notes/loading-skeleton.tsx` - 로딩 스켈레톤 UI 컴포넌트
- `app/notes/[id]/page.tsx` - 노트 상세 조회 페이지

**수정된 파일:**
- `lib/notes/actions.ts` - 페이지네이션 및 정렬 기능 추가 (getNotesPaginated 함수)
- `app/notes/page.tsx` - 페이지네이션 및 정렬 기능 통합
- `app/page.tsx` - 타입 오류 수정 (Note 타입 적용)
- `lib/db/test-connection.ts` - 타입 오류 수정

## QA Results

QA 에이전트가 완료된 스토리 구현을 검토한 결과입니다.
