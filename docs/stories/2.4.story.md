# Story 2.4: 노트 삭제 (즉시 삭제)

## Status

Ready for Review

## Story

**As a** 로그인한 사용자,
**I want** 불필요한 노트를 즉시 삭제할 수 있는 기능,
**so that** 노트 목록을 깔끔하게 관리하고 저장 공간을 효율적으로 사용할 수 있다.

## Acceptance Criteria

1. 노트 목록에서 개별 노트를 삭제할 수 있어야 한다
2. 노트 상세 페이지에서 노트를 삭제할 수 있어야 한다
3. 삭제 전 확인 다이얼로그가 표시되어야 한다
4. 삭제된 노트는 즉시 데이터베이스에서 제거되어야 한다
5. 삭제 후 노트 목록이 자동으로 업데이트되어야 한다
6. 삭제된 노트는 복구할 수 없어야 한다 (즉시 삭제)
7. 권한이 없는 노트는 삭제할 수 없어야 한다
8. 존재하지 않는 노트 삭제 시 적절한 에러 메시지가 표시되어야 한다
9. 삭제 중 로딩 상태가 표시되어야 한다
10. 삭제 실패 시 사용자에게 알림이 표시되어야 한다

## Tasks / Subtasks

- [x] 노트 삭제 API 구현 (AC: 4, 6, 7, 8, 10)
  - [x] Drizzle ORM을 사용한 노트 삭제 쿼리 구현
  - [x] 사용자 권한 검증 로직 구현
  - [x] 노트 존재 여부 검증 로직 구현
  - [x] 에러 핸들링 (404, 403) 구현
  - [x] 삭제 성공/실패 응답 처리 구현
- [x] 삭제 확인 다이얼로그 컴포넌트 구현 (AC: 3, 9)
  - [x] shadcn/ui Dialog 컴포넌트 활용
  - [x] 삭제 확인 메시지 표시
  - [x] 취소/삭제 버튼 구현
  - [x] 로딩 상태 표시 구현
- [x] 노트 목록에서 삭제 기능 구현 (AC: 1, 5, 9, 10)
  - [x] 삭제 버튼 UI 추가
  - [x] 삭제 확인 다이얼로그 연동
  - [x] 삭제 후 목록 자동 새로고침
  - [x] 삭제 상태 피드백 표시
- [x] 노트 상세 페이지에서 삭제 기능 구현 (AC: 2, 5, 9, 10)
  - [x] 삭제 버튼 UI 추가
  - [x] 삭제 확인 다이얼로그 연동
  - [x] 삭제 후 목록 페이지로 리다이렉트
  - [x] 삭제 상태 피드백 표시
- [x] 반응형 디자인 적용 (AC: 1, 2, 3, 9, 10)
  - [x] 모바일 화면 최적화
  - [x] 태블릿 화면 최적화
  - [x] 데스크톱 화면 최적화

## Dev Notes

### 이전 스토리 인사이트

[Source: Story 2.3 Dev Agent Records]

- ✅ 노트 상세 조회 및 수정 기능 구현 완료
- ✅ 자동 저장 기능 구현 완료 (3초 디바운스 타이머)
- ✅ 사용자 권한 검증 로직 구현 완료
- ✅ 에러 핸들링 (404, 403) 구현 완료
- ✅ Drizzle ORM을 사용한 데이터 모델 완성

### 기술 스택 정보

[Source: docs/architecture.md#1-기술-스택]

- **프레임워크:** Next.js (App Router, Server Actions)
- **UI:** shadcn/ui + Tailwind + Radix UI
- **DB/인증:** Supabase (Postgres, Auth, Storage)
- **ORM:** Drizzle ORM

### 데이터베이스 스키마

[Source: lib/db/schema/notes.ts]

```typescript
export const notes = pgTable('notes', {
    id: uuid('id').defaultRandom().primaryKey(),
    userId: uuid('user_id').notNull(),
    title: text('title').notNull().default('제목 없음'),
    content: text('content'),
    createdAt: timestamp('created_at', { withTimezone: true }).defaultNow(),
    updatedAt: timestamp('updated_at', { withTimezone: true }).defaultNow()
})
```

### 기존 구현된 파일들

[Source: Story 2.3 File List]

- `lib/notes/actions.ts` - 노트 관련 Server Actions (createNote, getNotes, getNotesPaginated, getNoteById, updateNote 함수 포함)
- `app/notes/[id]/page.tsx` - 노트 상세 조회 페이지
- `app/notes/page.tsx` - 노트 목록 페이지
- `lib/db/connection.ts` - 데이터베이스 연결 설정
- `lib/db/schema/notes.ts` - 노트 데이터 모델 스키마

### 삭제 기능 요구사항

- **즉시 삭제:** 데이터베이스에서 완전히 제거 (soft delete 아님)
- **확인 다이얼로그:** 실수로 삭제하는 것을 방지
- **권한 검증:** 노트 소유자만 삭제 가능
- **에러 처리:** 404 (노트 없음), 403 (권한 없음), 일반 에러

### 보안 요구사항

[Source: docs/architecture.md#3-보안]

- 모든 Drizzle 쿼리는 사용자 ID 스코프를 WHERE로 직접 강제
- Supabase RLS 정책으로 추가 보안 레이어 제공
- 노트 소유자만 삭제 가능

### 재사용 가능한 컴포넌트

- `components/ui/dialog.tsx` - 삭제 확인 다이얼로그
- `components/ui/button.tsx` - 삭제 버튼
- `components/ui/card.tsx` - 노트 카드 (삭제 버튼 추가)

### UX/UI 고려사항

- **확인 다이얼로그:** 삭제 전 명확한 확인 절차
- **로딩 상태:** 삭제 중 사용자 피드백 제공
- **에러 처리:** 삭제 실패 시 사용자 친화적 메시지
- **모바일 최적화:** 터치 기반 삭제에 최적화된 UI

### Testing

#### 테스트 표준

[Source: docs/architecture.md#6-배포운영]

- 테스트 프레임워크: Jest + React Testing Library
- 테스트 파일 위치: `__tests__/` 또는 컴포넌트 옆에 `.test.tsx`

#### 노트 삭제 테스트

- 노트 삭제 API 테스트 (성공, 실패, 권한 검증)
- 삭제 확인 다이얼로그 테스트
- 삭제 후 UI 업데이트 테스트
- 에러 핸들링 테스트 (404, 403, 네트워크 오류)
- 권한 검증 테스트
- 반응형 디자인 테스트

## Change Log

| Date       | Version | Description | Author           |
| ---------- | ------- | ----------- | ---------------- |
| 2025-01-15 | 1.0     | 스토리 생성 | Scrum Master Bob |

## Dev Agent Record

### Agent Model Used

Claude Sonnet 4

### Debug Log References

- 노트 삭제 API 구현 완료 (deleteNote 함수)
- 삭제 확인 다이얼로그 컴포넌트 구현 완료
- 노트 카드 컴포넌트에 삭제 기능 통합 완료
- 노트 상세 페이지에 삭제 기능 추가 완료
- 반응형 디자인 적용 완료

### Completion Notes List

- ✅ 노트 삭제 API 구현 완료 (사용자 권한 검증, 에러 핸들링 포함)
- ✅ 삭제 확인 다이얼로그 컴포넌트 구현 완료 (로딩 상태, 에러 처리 포함)
- ✅ 노트 카드 컴포넌트에 삭제 기능 통합 완료 (호버 시 버튼 표시)
- ✅ 노트 상세 페이지에 삭제 기능 추가 완료 (네비게이션 바에 삭제 버튼)
- ✅ 반응형 디자인 적용 완료 (모바일, 태블릿, 데스크톱 최적화)
- ✅ 테스트 코드 작성 완료 (API, 컴포넌트 테스트)
- ✅ 린팅 오류 수정 완료

### File List

**새로 생성된 파일:**
- `components/notes/delete-note-dialog.tsx` - 노트 삭제 확인 다이얼로그 컴포넌트
- `components/notes/note-page-actions.tsx` - 노트 상세 페이지 액션 버튼 컴포넌트
- `__tests__/lib/notes/actions.test.ts` - 노트 삭제 API 테스트
- `__tests__/components/notes/delete-note-dialog.test.tsx` - 삭제 다이얼로그 컴포넌트 테스트
- `__tests__/components/notes/note-card.test.tsx` - 노트 카드 컴포넌트 테스트

**수정된 파일:**
- `lib/notes/actions.ts` - 노트 삭제 Server Action 추가 (deleteNote 함수)
- `components/notes/note-card.tsx` - 삭제 기능 통합 (클라이언트 컴포넌트로 변경)
- `app/notes/[id]/page.tsx` - 삭제 기능 추가 (NotePageActions 컴포넌트 사용)

## QA Results

*This section will be populated by the QA agent after implementation review*
